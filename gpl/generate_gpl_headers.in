#!/bin/bash

header_files=`find $1 | grep -e '\.h' -e '\.hpp' | grep -v '.svn' | grep -v 'newmat'`
# generating GPL header files
TMP_FILENAME=`tempfile`
for f in $header_files
do
    ftmp=`echo $f | cut -b 4-`
    if [ `grep $ftmp @PROJECT_SOURCE_DIR@/gpl/excluded_files` ]
    then 
       echo excluded file $f.
    else
       filename=`basename $f`
       # first, write license header information
       cat @PROJECT_SOURCE_DIR@/gpl/license_header > $TMP_FILENAME
       
       # remove all information between include guards, and write result
       sed -n -e'/#ifndef/,$p' $f >> $TMP_FILENAME
       mv $TMP_FILENAME $f
    fi
done
